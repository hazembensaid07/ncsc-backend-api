name: NCSC  CI_CD

on:
  push:
    branches: [production]
  pull_request:
    branches: [production]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v2
      - name: Set up QEMU
        uses: docker/setup-qemu-action@v1
      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v1
      - name: Login to DockerHub
        uses: docker/login-action@v1
        with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}
      - name: Build and push node
        uses: docker/build-push-action@v2
        with:
          context: .
          push: true
          tags: hazem06/ncsc_backend:node-app-latest
      - name: Build and push nginx
        uses: docker/build-push-action@v2
        with:
          context: ./nginx/
          push: true
          tags: hazem06/ncsc_backend:nginx-latest
  test: 
   runs-on: ubuntu-latest
    steps:
    - name: Checkout
        uses: actions/checkout@v2
    - name: Login to DockerHub
        uses: docker/login-action@v1
        with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}
    -name : pull the image 
      run : docker pull  hazem06/ncsc_backend:node-app-latest
    -name : run the test 
      run : echo 'testing'